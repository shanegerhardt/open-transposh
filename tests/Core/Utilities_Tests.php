<?php

namespace Tests\Core;

use OpenTransposh\Core\Utilities;
use OpenTransposh\Logging\Logger;
use WP_UnitTestCase;

ini_set( "include_path", "../core" . PATH_SEPARATOR . "../../core" . PATH_SEPARATOR . ini_get( "include_path" ) );
define( "DEBUG", 5 );

/**
 * Test class for utils.
 * Generated by PHPUnit on 2009-06-15 at 13:21:30.
 */
class Utilities_Tests extends WP_UnitTestCase {

	/**
	 * @var    Utilities
	 * @access protected
	 */
	protected $object;

	/**
	 * Sets up the fixture, for example, opens a network connection.
	 * This method is called before a test is executed.
	 *
	 * @access protected
	 */
	protected function setUp(): void {
		$GLOBALS['logger']              = Logger::get_instance();
		$GLOBALS['logger']->show_caller = true;
		$GLOBALS['logger']->set_debug_level( 5 );
		$GLOBALS['logger']->eolprint = true;
		$GLOBALS['logger']->printout = true;
	}

	public function testRewriteURL() {
		$edit        = false;
		$params_only = false;
		$homeurl     = "https://transposh.org";
		$permalinks  = true;
		$this->assertEquals( "/he/", Utilities::rewrite_url_lang_param( "", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test", Utilities::rewrite_url_lang_param( "/test", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test/", Utilities::rewrite_url_lang_param( "/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test/", Utilities::rewrite_url_lang_param( "/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test/", Utilities::rewrite_url_lang_param( "/en/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/zh-tw/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/37/", Utilities::rewrite_url_lang_param( "https://transposh.org/37/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh-tw&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&amp;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&#038;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?cat=y", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "he", $edit, $params_only ) );
	}

	public function testRewriteURLedit() {
		$edit        = true;
		$params_only = false;
		$homeurl     = "https://transposh.org";
		$permalinks  = true;
		$this->assertEquals( "/he/?edit=1", Utilities::rewrite_url_lang_param( "", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/?edit=1", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test?edit=1", Utilities::rewrite_url_lang_param( "/test", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test/?edit=1", Utilities::rewrite_url_lang_param( "/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test/?edit=1", Utilities::rewrite_url_lang_param( "/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/test/?edit=1", Utilities::rewrite_url_lang_param( "/en/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/zh-tw/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/37/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/37/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh-tw&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&amp;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&#038;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/he/?cat=y&edit=1", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "he", $edit, $params_only ) );
	}

	public function testRewriteURLparams() {
		$edit        = false;
		$params_only = true;
		$homeurl     = "https://transposh.org";
		$permalinks  = true;
		$this->assertEquals( "?lang=he", Utilities::rewrite_url_lang_param( "", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/?lang=he", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test?lang=he", Utilities::rewrite_url_lang_param( "/test", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/?lang=he", Utilities::rewrite_url_lang_param( "/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/?lang=he", Utilities::rewrite_url_lang_param( "/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/?lang=he", Utilities::rewrite_url_lang_param( "/en/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/zh-tw/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/37/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/37/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh-tw&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&amp;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&#038;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/?cat=y&lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "he", $edit, $params_only ) );
	}

	public function testRewriteURLwithsubdir() {
		//$GLOBALS[home_url] = "https://transposh.org/test/";
		$edit        = false;
		$params_only = false;
		$homeurl     = "https://transposh.org/test/";
		$permalinks  = true;
		$this->assertEquals( "/he/", Utilities::rewrite_url_lang_param( "", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/he/", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/he/", Utilities::rewrite_url_lang_param( "/test", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/he/", Utilities::rewrite_url_lang_param( "/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/he/", Utilities::rewrite_url_lang_param( "/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/he/", Utilities::rewrite_url_lang_param( "/test/en/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/zh-tw/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/37/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/37/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh-tw&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&amp;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&#038;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/he/?cat=y", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "he", $edit, $params_only ) );

		$this->assertEquals( "/", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?cat=y", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "", $edit, $params_only ) );
	}

	public function testRewriteURLwithsubdir2() {
		//$GLOBALS[home_url] = "https://transposh.org/test/";
		$edit        = false;
		$params_only = true;
		$homeurl     = "https://transposh.org/test/";
		$permalinks  = true;
		$this->assertEquals( "?lang=he", Utilities::rewrite_url_lang_param( "", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/?lang=he", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test?lang=he", Utilities::rewrite_url_lang_param( "/test", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/?lang=he", Utilities::rewrite_url_lang_param( "/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/?lang=he", Utilities::rewrite_url_lang_param( "/test/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "/test/?lang=he", Utilities::rewrite_url_lang_param( "/test/en/?lang=en", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/he/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://www.islands.co.il/fr/", Utilities::rewrite_url_lang_param( "https://www.islands.co.il/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/he", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/he/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/zh-tw/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/37/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/37/", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh-tw&edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&amp;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&#038;edit=1", $homeurl, $permalinks, "he", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?cat=y&lang=he", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "he", $edit, $params_only ) );

		$this->assertEquals( "", Utilities::rewrite_url_lang_param( "", $homeurl, $permalinks, "", $edit, $params_only ) );
		$this->assertEquals( "/", Utilities::rewrite_url_lang_param( "/", $homeurl, $permalinks, "", $edit, $params_only ) );
		$this->assertEquals( "https://transposh.org/test/?cat=y", Utilities::rewrite_url_lang_param( "https://transposh.org/test/fr/?lang=zh&#038;edit=1&cat=y", $homeurl, $permalinks, "", $edit, $params_only ) );
	}

	public function testCleanupURL() {
		$homeurl = "https://www.algarve-abc.de/ferienhaus-westalgarve/";
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve/test", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en/test", $homeurl ) );
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve", $homeurl ) );
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en", $homeurl ) );
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve/", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en/", $homeurl ) );
		$this->assertEquals( "/ferienhaus-westalgarve/", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en/", $homeurl, true ) );
	}

	public function testCleanupURL2() {
		$homeurl     = "https://www.algarve-abc.de/ferienhaus-westalgarve/";
		$params_only = true;
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve/test", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en/test", $homeurl ) );
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve", $homeurl ) );
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en", $homeurl ) );
		$this->assertEquals( "https://www.algarve-abc.de/ferienhaus-westalgarve/", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en/", $homeurl ) );
		$this->assertEquals( "/ferienhaus-westalgarve/", Utilities::cleanup_url( "https://www.algarve-abc.de/ferienhaus-westalgarve/en/", $homeurl, true ) );
	}

	public function testCleanupURL3() {
		$homeurl = "";
		//$params_only = true;
		$this->assertEquals( "/test", Utilities::cleanup_url( "/he/test", $homeurl ) );
		//$this->assertEquals("/test",cleanup_url("he/test",$homeurl));
	}

	public function testCleanupURL4() {
		$homeurl = "https://www.algarve-abc.de";
		$this->assertEquals( "/", Utilities::cleanup_url( "/he", $homeurl, true ) );
	}

	public function testGetOriginalURL() {
		$callback = static function ( $str = "", $param = "" ) {
			return $str;
		};
		$this->assertEquals( "/", Utilities::get_original_url( "/", '', 'en', $callback ) );
		$this->assertEquals( "/test", Utilities::get_original_url( "/test", '', 'en', $callback ) );
		$this->assertEquals( "/test/", Utilities::get_original_url( "/test/", '', 'en', $callback ) );
		$this->assertEquals( "www.islands.co.il/he/test/", Utilities::get_original_url( "www.islands.co.il/he/test/", 'www.islands.co.il', 'en', $callback ) );
		$this->assertEquals( "https://www.islands.co.il/he/test/", Utilities::get_original_url( "https://www.islands.co.il/he/test/", 'https://www.islands.co.il', 'en', $callback ) );
	}

	public function testTranslateURL() {
		$callback = static function ( $str = "", $param = "" ) {
			return array( $str, '0' );
		};
		$this->assertEquals( "/", Utilities::translate_url( "/", '', 'en', $callback ) );
		$this->assertEquals( "/test", Utilities::translate_url( "/test", '', 'en', $callback ) );
		$this->assertEquals( "/test/", Utilities::translate_url( "/test/", '', 'en', $callback ) );
		$this->assertEquals( "www.islands.co.il/he/test/", Utilities::translate_url( "www.islands.co.il/he/test/", 'www.islands.co.il', 'en', $callback ) );
		$this->assertEquals( "www.islands.co.il?lang=he", Utilities::translate_url( "www.islands.co.il?lang=he", 'www.islands.co.il', 'en', $callback ) );
		$this->assertEquals( "https://www.islands.co.il/he/test/", Utilities::translate_url( "https://www.islands.co.il/he/test/", 'https://www.islands.co.il', 'en', $callback ) );
		$this->assertEquals( "https://www.islands.co.il/he/test/?edit=1", Utilities::translate_url( "https://www.islands.co.il/he/test/?edit=1", 'https://www.islands.co.il', 'en', $callback ) );
	}

	public function testGrabLanguage() {
		$home_url = "https://transposh.org";
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/he/test/", $home_url ) );
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/he", $home_url ) );
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/?lang=he", $home_url ) );
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/he/?lang=he", $home_url ) );
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/he/?lang=he&fakeparam=no", $home_url ) );
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/he/?fake=no&lang=he&fakeparam=no", $home_url ) );
		$this->assertEquals( "he", Utilities::get_language_from_url( "https://transposh.org/hello/test/?lang=he", $home_url ) );
	}

}